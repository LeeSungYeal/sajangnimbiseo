module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/node:stream [external] (node:stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:stream", () => require("node:stream"));

module.exports = mod;
}),
"[externals]/buffer [external] (buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}),
"[externals]/string_decoder [external] (string_decoder, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("string_decoder", () => require("string_decoder"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/node:assert [external] (node:assert, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:assert", () => require("node:assert"));

module.exports = mod;
}),
"[externals]/node:net [external] (node:net, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:net", () => require("node:net"));

module.exports = mod;
}),
"[externals]/node:http [external] (node:http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:http", () => require("node:http"));

module.exports = mod;
}),
"[externals]/node:querystring [external] (node:querystring, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:querystring", () => require("node:querystring"));

module.exports = mod;
}),
"[externals]/node:events [external] (node:events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:events", () => require("node:events"));

module.exports = mod;
}),
"[externals]/node:diagnostics_channel [external] (node:diagnostics_channel, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:diagnostics_channel", () => require("node:diagnostics_channel"));

module.exports = mod;
}),
"[externals]/node:util [external] (node:util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:util", () => require("node:util"));

module.exports = mod;
}),
"[externals]/node:tls [external] (node:tls, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:tls", () => require("node:tls"));

module.exports = mod;
}),
"[externals]/node:buffer [external] (node:buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:buffer", () => require("node:buffer"));

module.exports = mod;
}),
"[externals]/node:zlib [external] (node:zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:zlib", () => require("node:zlib"));

module.exports = mod;
}),
"[externals]/node:perf_hooks [external] (node:perf_hooks, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:perf_hooks", () => require("node:perf_hooks"));

module.exports = mod;
}),
"[externals]/node:util/types [external] (node:util/types, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:util/types", () => require("node:util/types"));

module.exports = mod;
}),
"[externals]/node:crypto [external] (node:crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:crypto", () => require("node:crypto"));

module.exports = mod;
}),
"[externals]/node:worker_threads [external] (node:worker_threads, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:worker_threads", () => require("node:worker_threads"));

module.exports = mod;
}),
"[externals]/node:http2 [external] (node:http2, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:http2", () => require("node:http2"));

module.exports = mod;
}),
"[externals]/node:async_hooks [external] (node:async_hooks, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:async_hooks", () => require("node:async_hooks"));

module.exports = mod;
}),
"[externals]/node:console [external] (node:console, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:console", () => require("node:console"));

module.exports = mod;
}),
"[externals]/node:fs/promises [external] (node:fs/promises, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:fs/promises", () => require("node:fs/promises"));

module.exports = mod;
}),
"[externals]/node:path [external] (node:path, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:path", () => require("node:path"));

module.exports = mod;
}),
"[externals]/node:timers [external] (node:timers, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:timers", () => require("node:timers"));

module.exports = mod;
}),
"[externals]/node:dns [external] (node:dns, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:dns", () => require("node:dns"));

module.exports = mod;
}),
"[project]/src/lib/services/nia-scraper.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "fetchNiaDetail",
    ()=>fetchNiaDetail,
    "fetchNiaList",
    ()=>fetchNiaList,
    "scrapeNiaAnnouncements",
    ()=>scrapeNiaAnnouncements
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/cheerio/dist/esm/index.js [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/cheerio/dist/esm/load-parse.js [app-route] (ecmascript)");
;
const BASE_URL = "https://www.nia.or.kr";
const LIST_URL = `${BASE_URL}/site/nia_kor/ex/bbs/List.do?cbIdx=78336`;
const DETAIL_URL = `${BASE_URL}/site/nia_kor/ex/bbs/View.do`;
const USER_AGENT = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36";
// ── HTML fetch helper ─────────────────────────────────────────────────────────
async function fetchHtml(url) {
    const res = await fetch(url, {
        headers: {
            "User-Agent": USER_AGENT,
            "Referer": BASE_URL
        },
        signal: AbortSignal.timeout(20_000)
    });
    if (!res.ok) throw new Error(`HTTP ${res.status}: ${url}`);
    return res.text();
}
// ── 날짜 정규화 (2026.02.24 → 2026-02-24) ────────────────────────────────────
function normalizeDate(raw) {
    const m = raw.trim().match(/(\d{4})[.\-/](\d{1,2})[.\-/](\d{1,2})/);
    if (!m) return raw.trim();
    return `${m[1]}-${m[2].padStart(2, "0")}-${m[3].padStart(2, "0")}`;
}
async function fetchNiaList(maxPages = 1) {
    const items = [];
    for(let page = 1; page <= maxPages; page++){
        const url = page === 1 ? LIST_URL : `${LIST_URL}&pageIndex=${page}`;
        const html = await fetchHtml(url);
        const $ = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["load"](html);
        // a[href="#view"] 기반으로 공고 항목 탐색 (ul.board-list 클래스 없음)
        $("a[href='#view']").each((_, anchor)=>{
            const onclick = $(anchor).attr("onclick") ?? "";
            // onclick: doBbsFView('78336','29066','16010100','29066');return false;
            const match = onclick.match(/doBbsFView\(\s*['"]?\d+['"]?\s*,\s*['"]?(\d+)['"]?/);
            if (!match) return;
            const bcIdx = match[1];
            // 제목: span 목록에서 아이콘/뱃지 제외하고 텍스트 합치기
            const spans = $(anchor).find("span").toArray();
            const spanTexts = spans// eslint-disable-next-line @typescript-eslint/no-explicit-any
            .map((s)=>$(s).clone().children().remove().end().text().trim()).filter((t)=>t.length > 1 && !/^(첨부|new|N)$/i.test(t));
            // span에서 추출 실패하면 anchor 전체 텍스트(정제) 사용
            const title = spanTexts.length > 0 ? spanTexts.join(" ").replace(/\s+/g, " ").trim() : $(anchor).clone().find("em").remove().end().text().replace(/\s+/g, " ").trim();
            if (!title || title.length < 2) return;
            // 날짜: 같은 a 태그 내 em 또는 span > em에서 날짜 패턴
            const dateRaw = $(anchor).find("em").toArray().map((e)=>$(e).text().trim()).find((t)=>/\d{4}[.\-/]\d{1,2}[.\-/]\d{1,2}/.test(t)) ?? "";
            const date = normalizeDate(dateRaw);
            items.push({
                bcIdx,
                title,
                date
            });
        });
        if (items.length === 0 && page === 1) break;
    }
    return items;
}
async function fetchNiaDetail(bcIdx) {
    const url = `${DETAIL_URL}?cbIdx=78336&bcIdx=${bcIdx}`;
    const html = await fetchHtml(url);
    const $ = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["load"](html);
    // 날짜: .src em 또는 .type01_info em
    const dateRaw = $(".detail_type01 .src em, .type01_info .src em, .src em").first().text().trim() || $(".date, .reg_date").first().text().trim();
    const date = normalizeDate(dateRaw);
    // 본문: .con_area 내부 텍스트 (HTML태그 제거, 정제)
    const conArea = $(".detail_type01 .con_area, .con_area").first();
    const content = conArea.text().replace(/\s{3,}/g, "\n\n") // 연속 공백/줄바꿈 정리
    .trim();
    return {
        content,
        date
    };
}
async function scrapeNiaAnnouncements(maxPages = 1, fetchDetail = true) {
    const listItems = await fetchNiaList(maxPages);
    const results = [];
    for (const item of listItems){
        const source_url = `${DETAIL_URL}?cbIdx=78336&bcIdx=${item.bcIdx}`;
        let content = "";
        let date = item.date;
        if (fetchDetail) {
            try {
                const detail = await fetchNiaDetail(item.bcIdx);
                content = detail.content;
                // 상세 페이지 날짜가 더 정확한 경우 사용
                if (detail.date) date = detail.date;
            } catch (e) {
                console.warn(`[NiaScraper] Detail fetch failed for bcIdx=${item.bcIdx}:`, e);
            }
        }
        results.push({
            bcIdx: item.bcIdx,
            title: item.title,
            date,
            content,
            source_url
        });
    }
    return results;
}
}),
"[project]/src/lib/services/nipa-scraper.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "fetchNipaDetail",
    ()=>fetchNipaDetail,
    "fetchNipaList",
    ()=>fetchNipaList,
    "scrapeNipaAnnouncements",
    ()=>scrapeNipaAnnouncements
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/cheerio/dist/esm/index.js [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/cheerio/dist/esm/load-parse.js [app-route] (ecmascript)");
;
const BASE_URL = "https://www.nipa.kr";
const LIST_URL = `${BASE_URL}/home/2-3/`;
const USER_AGENT = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36";
// ── fetch helper ──────────────────────────────────────────────────────────────
async function fetchHtml(url) {
    const res = await fetch(url, {
        headers: {
            "User-Agent": USER_AGENT,
            "Referer": BASE_URL
        },
        signal: AbortSignal.timeout(20_000)
    });
    if (!res.ok) throw new Error(`HTTP ${res.status}: ${url}`);
    return res.text();
}
// ── 날짜 정규화 ───────────────────────────────────────────────────────────────
function normalizeDate(raw) {
    const m = raw.trim().match(/(\d{4})[.\-/](\d{1,2})[.\-/](\d{1,2})/);
    if (!m) return raw.trim();
    return `${m[1]}-${m[2].padStart(2, "0")}-${m[3].padStart(2, "0")}`;
}
async function fetchNipaList(maxPages = 1) {
    const items = [];
    for(let page = 1; page <= maxPages; page++){
        const url = page === 1 ? LIST_URL : `${LIST_URL}?page=${page}`;
        const html = await fetchHtml(url);
        const $ = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["load"](html);
        // 선택자: table.tb03 tbody tr > td.al > a (제목 링크)
        // 대안: td a[href*="/home/2-3/"]
        const linkEls = $("table td a[href*='/home/2-3/'], table.tb03 td.al a").toArray();
        if (linkEls.length === 0) {
            // 폴백: 모든 a[href] 에서 /home/2-3/{숫자} 패턴 탐색
            $("a[href]").each((_, el)=>{
                const href = $(el).attr("href") ?? "";
                const match = href.match(/\/home\/2-3\/(\d+)/);
                if (!match) return;
                const articleId = match[1];
                const title = $(el).text().trim();
                if (!title || title.length < 2) return;
                const rowText = $(el).closest("tr").text();
                const date = normalizeDate(rowText.match(/(\d{4})[.\-/]\d{1,2}[.\-/]\d{1,2}/)?.[0] ?? "");
                if (!items.find((i)=>i.articleId === articleId)) {
                    items.push({
                        articleId,
                        title,
                        date
                    });
                }
            });
        } else {
            for (const el of linkEls){
                const href = $(el).attr("href") ?? "";
                const match = href.match(/\/home\/2-3\/(\d+)/);
                if (!match) continue;
                const articleId = match[1];
                const title = $(el).text().replace(/\s+/g, " ").trim();
                if (!title || title.length < 2) continue;
                // 날짜: 같은 tr의 텍스트에서 추출
                const rowText = $(el).closest("tr").text();
                const date = normalizeDate(rowText.match(/(\d{4})[.\-/]\d{1,2}[.\-/]\d{1,2}/)?.[0] ?? "");
                if (!items.find((i)=>i.articleId === articleId)) {
                    items.push({
                        articleId,
                        title,
                        date
                    });
                }
            }
        }
        if (linkEls.length === 0) break;
    }
    return items;
}
async function fetchNipaDetail(articleId) {
    const url = `${BASE_URL}/home/2-3/${articleId}`;
    const html = await fetchHtml(url);
    const $ = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["load"](html);
    // 제목: table.tb05 thead tr th, .view-title, h3 등
    const title = $("table.tb05 thead tr th, .view-title, .tit_view, h3.tit").first().text().trim() || $("h2, h3").first().text().trim();
    // 날짜: span.infoDt, .reg-date, .date 등
    const dateRaw = $("span.infoDt, .reg-date, [class*='date']").toArray().map((e)=>$(e).text().trim()).find((t)=>/\d{4}[.\-/]\d{1,2}[.\-/]\d{1,2}/.test(t)) ?? "";
    const date = normalizeDate(dateRaw);
    // 본문: div.tbCont, .view-content, .board-content
    const content = $("div.tbCont, .view-content, .board-content, .con_area").first().text().replace(/\s{3,}/g, "\n\n").trim();
    return {
        title,
        date,
        content
    };
}
async function scrapeNipaAnnouncements(maxPages = 1, fetchDetail = true) {
    const listItems = await fetchNipaList(maxPages);
    const results = [];
    for (const item of listItems){
        const source_url = `${BASE_URL}/home/2-3/${item.articleId}`;
        let content = "";
        let date = item.date;
        let title = item.title;
        if (fetchDetail) {
            try {
                const detail = await fetchNipaDetail(item.articleId);
                content = detail.content;
                if (detail.date) date = detail.date;
                if (detail.title && detail.title.length > title.length) title = detail.title;
            } catch (e) {
                console.warn(`[NipaScraper] Detail fetch failed for articleId=${item.articleId}:`, e);
            }
        }
        results.push({
            articleId: item.articleId,
            title,
            date,
            content,
            source_url
        });
    }
    return results;
}
}),
"[externals]/events [external] (events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/util [external] (util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}),
"[externals]/fs [external] (fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/zlib [external] (zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}),
"[externals]/net [external] (net, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}),
"[externals]/dns [external] (dns, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("dns", () => require("dns"));

module.exports = mod;
}),
"[externals]/os [external] (os, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}),
"[externals]/path [external] (path, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}),
"[externals]/crypto [external] (crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}),
"[externals]/tls [external] (tls, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}),
"[externals]/child_process [external] (child_process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("child_process", () => require("child_process"));

module.exports = mod;
}),
"[project]/src/lib/services/email.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "sendNewAnnouncementsEmail",
    ()=>sendNewAnnouncementsEmail
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$nodemailer$2f$lib$2f$nodemailer$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/nodemailer/lib/nodemailer.js [app-route] (ecmascript)");
;
// ── SMTP 트랜스포터 (hanbiro, SSL 465) ───────────────────────────────────────
function createTransporter() {
    const password = process.env.SMTP_PASSWORD;
    const from = process.env.SMTP_FROM;
    if (!password) throw new Error("SMTP_PASSWORD 환경변수가 설정되지 않았습니다.");
    if (!from) throw new Error("SMTP_FROM 환경변수가 설정되지 않았습니다.");
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$nodemailer$2f$lib$2f$nodemailer$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].createTransport({
        host: "mtsco.hanbiro.net",
        port: 465,
        secure: true,
        auth: {
            user: from,
            pass: password
        }
    });
}
async function sendNewAnnouncementsEmail(items) {
    if (items.length === 0) return;
    const from = process.env.SMTP_FROM;
    const to = process.env.SMTP_TO;
    if (!from || !to) throw new Error("SMTP_FROM 또는 SMTP_TO 환경변수가 설정되지 않았습니다.");
    const transporter = createTransporter();
    // ── 카테고리 뱃지 ─────────────────────────────────────────────────────────────
    const categoryBadge = (cat)=>{
        const map = {
            "입찰공고": {
                bg: "#1c3d9c",
                color: "#ffffff"
            },
            "공모": {
                bg: "#166534",
                color: "#ffffff"
            },
            "지원사업": {
                bg: "#92400e",
                color: "#ffffff"
            },
            "조달": {
                bg: "#6b21a8",
                color: "#ffffff"
            }
        };
        const c = cat ?? "-";
        const s = map[c] ?? {
            bg: "#475569",
            color: "#ffffff"
        };
        return `<span style="display:inline-block;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:700;background-color:${s.bg};color:${s.color};white-space:nowrap;">${c}</span>`;
    };
    // ── 행 생성 ─────────────────────────────────────────────────────────────────
    const rows = items.map((item, i)=>{
        const dateStr = item.announce_date ?? "-";
        const titleHtml = item.source_url ? `<a href="${item.source_url}" style="color:#0a1e6e;text-decoration:none;font-weight:900;font-size:14px;line-height:1.6;letter-spacing:-0.01em;">${item.title} <span style="font-size:12px;">↗</span></a>` : `<span style="color:#0a1e6e;font-weight:900;font-size:14px;line-height:1.6;">${item.title}</span>`;
        const rowBg = i % 2 === 0 ? "#ffffff" : "#f9fafb";
        return `<tr style="background-color:${rowBg};">
      <td style="padding:14px 0;border-bottom:1px solid #edf0f7;text-align:center;vertical-align:middle;width:40px;color:#3a4a6b;font-size:12px;font-weight:700;">${i + 1}</td>
      <td style="padding:14px 8px;border-bottom:1px solid #edf0f7;">${titleHtml}</td>
      <td style="padding:14px 10px;border-bottom:1px solid #edf0f7;font-size:12px;color:#1e293b;white-space:nowrap;vertical-align:middle;font-weight:600;">${item.org_name ?? "미상"}</td>
      <td style="padding:14px 10px;border-bottom:1px solid #edf0f7;vertical-align:middle;">${categoryBadge(item.category)}</td>
      <td style="padding:14px 16px 14px 8px;border-bottom:1px solid #edf0f7;white-space:nowrap;vertical-align:middle;font-size:12px;color:#1e293b;font-weight:600;">${dateStr}</td>
    </tr>`;
    }).join("");
    // ── 날짜 ────────────────────────────────────────────────────────────────────
    const dateLabel = new Date().toLocaleDateString("ko-KR", {
        year: "numeric",
        month: "long",
        day: "numeric",
        weekday: "long"
    });
    const shortDate = new Date().toLocaleDateString("ko-KR", {
        month: "long",
        day: "numeric"
    });
    const html = `<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>신규 사업공고 알림</title>
</head>
<body style="margin:0;padding:0;background-color:#eef1f7;font-family:'Apple SD Gothic Neo','Malgun Gothic',Arial,sans-serif;">
<table width="100%" cellpadding="0" cellspacing="0" style="background-color:#eef1f7;">
<tr><td align="center" style="padding:24px 16px 40px;">
<table width="620" cellpadding="0" cellspacing="0" style="max-width:620px;width:100%;">

  <!-- ══ 상단 브랜드바 ══ -->
  <tr><td style="padding:0 0 12px;">
    <table width="100%" cellpadding="0" cellspacing="0"><tr>
      <td>
        <table cellpadding="0" cellspacing="0"><tr>
          <td style="font-size:13px;font-weight:700;color:#1c3d9c;letter-spacing:-0.01em;">에이마비서</td>
          <td style="padding:0 10px;"><span style="display:inline-block;width:1px;height:14px;background-color:#c0c8d8;vertical-align:middle;"></span></td>
          <td style="font-size:10px;color:#8a96aa;font-weight:500;letter-spacing:0.1em;text-transform:uppercase;">Business Announcement Alert</td>
        </tr></table>
      </td>
    </tr></table>
  </td></tr>

  <!-- ══ 메인 카드 ══ -->
  <tr><td style="border-radius:8px;overflow:hidden;box-shadow:0 2px 12px rgba(0,0,0,0.10);">

    <!-- ① 헤더 (파란 배경) -->
    <table width="100%" cellpadding="0" cellspacing="0" style="background-color:#1c3d9c;">
      <tr>
        <td style="padding:22px 28px 0 28px;">
          <table width="100%" cellpadding="0" cellspacing="0"><tr>
            <td style="vertical-align:top;">
              <p style="margin:0 0 6px;font-size:10px;font-weight:700;color:#a0b4e8;letter-spacing:0.1em;text-transform:uppercase;">&#128203; NEW BUSINESS ANNOUNCEMENTS</p>
              <h1 style="margin:0;font-size:22px;font-weight:900;color:#ffffff;line-height:1.25;letter-spacing:-0.02em;">신규 사업공고<br>알림 리포트</h1>
              <p style="margin:8px 0 0;font-size:12px;color:#a0b4e8;">${dateLabel}</p>
            </td>
            <td style="vertical-align:top;text-align:right;padding-left:20px;">
              <table cellpadding="0" cellspacing="0" style="margin-left:auto;background-color:#162e7a;border-radius:6px;overflow:hidden;min-width:100px;">
                <tr><td style="padding:10px 16px;text-align:center;">
                  <div style="font-size:38px;font-weight:900;color:#f5a623;line-height:1;letter-spacing:-2px;">${items.length}</div>
                  <div style="font-size:10px;color:#a0b4e8;margin-top:4px;">건의 신규 공고</div>
                  <div style="font-size:10px;color:#6a80b0;margin-top:1px;">${shortDate} 기준</div>
                </td></tr>
              </table>
            </td>
          </tr></table>
        </td>
      </tr>
      <!-- 클릭 안내 버튼 -->
      <tr>
        <td style="padding:14px 28px 20px;">
          <table cellpadding="0" cellspacing="0">
            <tr><td style="background-color:#f5a623;border-radius:6px;padding:9px 24px;text-align:center;">
              <span style="font-size:12px;font-weight:700;color:#1c3d9c;">&#128276;&nbsp; 공고명 클릭 시 원문으로 바로 이동합니다</span>
            </td></tr>
          </table>
        </td>
      </tr>
    </table>

    <!-- ③ 테이블 헤더 -->
    <table width="100%" cellpadding="0" cellspacing="0" style="background-color:#f0f2f7;border-top:1px solid #dde2ef;">
      <tr>
        <th style="width:40px;padding:10px 0;font-size:11px;font-weight:700;color:#6b7897;text-align:center;">#</th>
        <th style="padding:10px 8px;font-size:11px;font-weight:700;color:#3a4a6b;text-align:left;letter-spacing:0.05em;">공&nbsp;&nbsp;고&nbsp;&nbsp;명</th>
        <th style="padding:10px 10px;font-size:11px;font-weight:700;color:#3a4a6b;text-align:left;white-space:nowrap;">기 관</th>
        <th style="padding:10px 10px;font-size:11px;font-weight:700;color:#3a4a6b;text-align:center;white-space:nowrap;">구 분</th>
        <th style="padding:10px 16px 10px 8px;font-size:11px;font-weight:700;color:#3a4a6b;text-align:right;white-space:nowrap;">날 짜</th>
      </tr>
    </table>

    <!-- ④ 공고 행 -->
    <table width="100%" cellpadding="0" cellspacing="0" style="background-color:#ffffff;">
      ${rows}
    </table>

    <!-- ⑥ 푸터 -->
    <table width="100%" cellpadding="0" cellspacing="0" style="background-color:#f7f9fc;border-top:1px solid #e2e8f0;">
      <tr>
        <td style="padding:18px 24px;">
          <table width="100%" cellpadding="0" cellspacing="0">
            <tr>
              <td>
                <p style="margin:0;font-size:12px;color:#6b7897;line-height:1.8;">
                  본 메일은 <strong style="color:#1c3d9c;">에이마비서</strong>의 사업공고 자동 수집 시스템이 발송했습니다.<br>
                  수신 거부 · 문의: 관리자에게 연락하세요.
                </p>
              </td>
              <td style="text-align:right;vertical-align:middle;padding-left:16px;">
                <div style="display:inline-block;background-color:#1c3d9c;border-radius:6px;padding:8px 16px;text-align:center;">
                  <div style="font-size:12px;font-weight:700;color:#ffffff;">에이마비서</div>
                </div>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>

  </td></tr><!-- /메인 카드 -->

</table>
</td></tr>
</table>
</body>
</html>`;
    await transporter.sendMail({
        from: `"에이마비서 알림" <${from}>`,
        to: to,
        subject: `[사업공고] 신규 ${items.length}건 - ${new Date().toLocaleDateString("ko-KR")}`,
        html
    });
    console.log(`[Email] 신규 공고 ${items.length}건 이메일 발송 완료 → ${to}`);
}
}),
"[project]/src/lib/services/rfp-scraper.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "DynamicScraperStub",
    ()=>DynamicScraperStub,
    "RfpScraper",
    ()=>RfpScraper,
    "StaticScraper",
    ()=>StaticScraper
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/cheerio/dist/esm/index.js [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/cheerio/dist/esm/load-parse.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/@supabase/supabase-js/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$services$2f$nia$2d$scraper$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/services/nia-scraper.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$services$2f$nipa$2d$scraper$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/services/nipa-scraper.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$services$2f$email$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/services/email.ts [app-route] (ecmascript)");
;
;
;
;
;
// ── Supabase Admin Client (service_role 우선, 없으면 anon key 폴백) ──────────
function getAdminClient() {
    const url = ("TURBOPACK compile-time value", "https://zrdcdkafvpbbcmyrzeku.supabase.co");
    // rfp_announcements는 RLS disabled이므로 anon key로도 INSERT 가능
    const key = process.env.SUPABASE_SERVICE_ROLE_KEY && process.env.SUPABASE_SERVICE_ROLE_KEY !== "your-service-role-key-here" ? process.env.SUPABASE_SERVICE_ROLE_KEY : ("TURBOPACK compile-time value", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpyZGNka2FmdnBiYmNteXJ6ZWt1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg1NTAyODAsImV4cCI6MjA4NDEyNjI4MH0.CvbveMYPBr-U5ktBFm8jgAt0DE3l9Xv6OuSZeQ9r9pQ");
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$supabase$2f$supabase$2d$js$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["createClient"])(url, key, {
        auth: {
            persistSession: false
        }
    });
}
// ── unique_key 생성 (단방향 해시 없이 결정적 문자열로 처리) ─────────────────
function buildUniqueKey(orgId, title, announce_date) {
    const d = announce_date ?? "no-deadline";
    // Node.js crypto 없이 간단한 결정적 키 생성 (서버리스 환경 호환)
    return `${orgId}::${title.trim().toLowerCase()}::${d}`;
}
class StaticScraper {
    userAgent = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36";
    async scrape(rfpUrl) {
        const html = await this.fetchHtml(rfpUrl);
        const $ = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$cheerio$2f$dist$2f$esm$2f$load$2d$parse$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["load"](html);
        const results = [];
        // ── 전략 1: table 기반 목록 ─────────────────────────────────────────
        const tableRows = $("table tbody tr, table tr").toArray();
        if (tableRows.length > 0) {
            for (const row of tableRows){
                const cells = $(row).find("td");
                if (cells.length < 2) continue;
                const titleEl = $(row).find("td a").first();
                const title = titleEl.text().trim() || $(cells.get(0)).text().trim();
                if (!title || title.length < 2) continue;
                const href = titleEl.attr("href");
                const source_url = href ? href.startsWith("http") ? href : new URL(href, rfpUrl).href : null;
                // 날짜 패턴 찾기 (YYYY-MM-DD, YYYY.MM.DD, YYYY/MM/DD)
                const rowText = $(row).text();
                const announce_date = this.extractDate(rowText);
                results.push({
                    title,
                    source_url,
                    announce_date,
                    description: null
                });
            }
        }
        // ── 전략 2: list item 기반 ──────────────────────────────────────────
        if (results.length === 0) {
            const listItems = $("ul li a, .list-item a, .bbs-list a, .board-list a, .notice-list a, article a").toArray();
            for (const el of listItems){
                const title = $(el).text().trim();
                if (!title || title.length < 3) continue;
                const href = $(el).attr("href");
                const source_url = href ? href.startsWith("http") ? href : new URL(href, rfpUrl).href : null;
                const parentText = $(el).parent().text();
                const announce_date = this.extractDate(parentText);
                results.push({
                    title,
                    source_url,
                    announce_date,
                    description: null
                });
            }
        }
        // ── 전략 3: RSS/Atom feed XML ────────────────────────────────────────
        if (results.length === 0 && (rfpUrl.includes("rss") || rfpUrl.includes("feed") || rfpUrl.includes("atom"))) {
            $("item, entry").each((_, el)=>{
                const title = $(el).find("title").text().trim();
                if (!title) return;
                const source_url = $(el).find("link").text().trim() || $(el).find("link").attr("href") || null;
                const pubDate = $(el).find("pubDate, published, updated").text().trim();
                const description = $(el).find("description, summary, content").text().trim() || null;
                const announce_date = this.extractDate(pubDate || "");
                results.push({
                    title,
                    source_url,
                    announce_date,
                    description
                });
            });
        }
        return results.slice(0, 100); // 최대 100개 제한
    }
    async fetchHtml(url) {
        const res = await fetch(url, {
            headers: {
                "User-Agent": this.userAgent
            },
            signal: AbortSignal.timeout(20_000)
        });
        if (!res.ok) throw new Error(`HTTP ${res.status} for ${url}`);
        return res.text();
    }
    /** 텍스트에서 YYYY-MM-DD / YYYY.MM.DD / YYYY/MM/DD 패턴 추출 */ extractDate(text) {
        const match = text.match(/(\d{4})[-./](\d{1,2})[-./](\d{1,2})/);
        if (!match) return null;
        const [, y, m, d] = match;
        return `${y}-${m.padStart(2, "0")}-${d.padStart(2, "0")}`;
    }
}
class DynamicScraperStub {
    async scrape(rfpUrl, orgName) {
        console.warn(`[RfpScraper] Dynamic Scraper not available in serverless env. ` + `Skipping ${orgName} (${rfpUrl}). ` + `To enable: integrate BrowserBase or ScrapingBee API.`);
        return [];
    }
}
class RfpScraper {
    staticScraper = new StaticScraper();
    dynamicScraper = new DynamicScraperStub();
    /** NIA(한국지능정보사회진흥원) URL 패턴 감지 */ isNiaUrl(url) {
        return url.includes("nia.or.kr") && url.includes("cbIdx=78336");
    }
    /** NIPA(정보통신산업진흥원) URL 패턴 감지 */ isNipaUrl(url) {
        return url.includes("nipa.kr");
    }
    async run() {
        const supabase = getAdminClient();
        const results = [];
        // 1. 활성 필터링 키워드 목록 조회
        const { data: keywordRows } = await supabase.from("rfp_filter_keywords").select("keyword").eq("is_active", true);
        const filterKeywords = (keywordRows ?? []).map((r)=>r.keyword.toLowerCase());
        if (filterKeywords.length > 0) {
            console.log(`[RfpScraper] 필터링 키워드 ${filterKeywords.length}개 적용: ${filterKeywords.join(", ")}`);
        } else {
            console.log("[RfpScraper] 필터링 키워드 없음 — 전체 수집 모드");
        }
        // 2. 수집 활성화된 기관 목록 조회
        const { data: orgs, error: orgsErr } = await supabase.from("rfp_public_org").select("id, org_name, org_type, homepage_url, rfp_url, coll_meth, is_active").eq("is_active", true);
        if (orgsErr) {
            console.error("[RfpScraper] Failed to fetch orgs:", orgsErr.message);
            return [
                {
                    org_id: 0,
                    org_name: "N/A",
                    status: "error",
                    inserted: 0,
                    skipped: 0,
                    error: orgsErr.message
                }
            ];
        }
        if (!orgs || orgs.length === 0) {
            console.log("[RfpScraper] No active orgs found.");
            return [];
        }
        console.log(`[RfpScraper] Processing ${orgs.length} active orgs`);
        // 3. 기관별 수집
        for (const org of orgs){
            const result = await this.scrapeOrg(supabase, org, filterKeywords);
            results.push(result);
            console.log(`[RfpScraper] ${org.org_name}: ${result.status} ` + `(inserted=${result.inserted}, skipped=${result.skipped})`);
        }
        // 4. 신규 공고가 있으면 이메일 발송
        const allNewItems = results.flatMap((r)=>r.newItems ?? []);
        if (allNewItems.length > 0) {
            try {
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$services$2f$email$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sendNewAnnouncementsEmail"])(allNewItems);
            } catch (mailErr) {
                console.error("[RfpScraper] 이메일 발송 실패:", mailErr.message);
            }
        }
        return results;
    }
    /** 제목 또는 설명에 활성 필터링 키워드가 하나라도 포함되는지 검사 */ matchesKeywords(ann, keywords) {
        if (keywords.length === 0) return true; // 키워드 없으면 전체 통과
        const haystack = [
            ann.title ?? "",
            ann.description ?? ""
        ].join(" ").toLowerCase();
        return keywords.some((kw)=>haystack.includes(kw));
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    async scrapeOrg(supabase, org, filterKeywords = []) {
        const base = {
            org_id: org.id,
            org_name: org.org_name,
            status: "success",
            inserted: 0,
            skipped: 0
        };
        if (!org.rfp_url) {
            return {
                ...base,
                status: "skipped",
                error: "rfp_url 없음"
            };
        }
        // 3. 엔진 분기: URL 패턴 우선 → coll_meth 순서로 결정
        let announcements = [];
        try {
            if (org.coll_meth === "Dynamic Scraper") {
                announcements = await this.dynamicScraper.scrape(org.rfp_url, org.org_name);
            } else if (this.isNiaUrl(org.rfp_url)) {
                // NIA(한국지능정보사회진흥원): 전용 스크래퍼 사용
                const niaResults = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$services$2f$nia$2d$scraper$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["scrapeNiaAnnouncements"])(1, true);
                announcements = niaResults.map((r)=>({
                        title: r.title,
                        category: "입찰공고",
                        announce_date: r.date || null,
                        description: r.content?.slice(0, 2000) || null,
                        source_url: r.source_url
                    }));
            } else if (this.isNipaUrl(org.rfp_url)) {
                // NIPA(정보통신산업진흥원): 전용 스크래퍼 사용
                const nipaResults = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$services$2f$nipa$2d$scraper$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["scrapeNipaAnnouncements"])(1, true);
                announcements = nipaResults.map((r)=>({
                        title: r.title,
                        category: "공고",
                        announce_date: r.date || null,
                        description: r.content?.slice(0, 2000) || null,
                        source_url: r.source_url
                    }));
            } else {
                // 범용 Cheerio 스크래퍼 (table/list/RSS 전략)
                announcements = await this.staticScraper.scrape(org.rfp_url);
            }
        } catch (err) {
            return {
                ...base,
                status: "error",
                error: err.message
            };
        }
        if (announcements.length === 0) {
            return {
                ...base,
                status: "skipped",
                error: "공고 없음 (파싱 결과 0건)"
            };
        }
        // 4. 필터링 키워드 적용
        const filtered = announcements.filter((ann)=>this.matchesKeywords(ann, filterKeywords));
        console.log(`[RfpScraper] ${org.org_name}: 수집 ${announcements.length}건 → 키워드 필터 후 ${filtered.length}건`);
        if (filtered.length === 0) {
            return {
                ...base,
                status: "skipped",
                error: "키워드 매칭 결과 0건"
            };
        }
        // 5. 증분 저장 (unique_key 기준 → 신규만 INSERT)
        let inserted = 0;
        let skipped = 0;
        const newItems = [];
        for (const ann of filtered){
            if (!ann.title?.trim()) continue;
            const unique_key = buildUniqueKey(org.id, ann.title, ann.announce_date);
            const row = {
                org_id: org.id,
                unique_key,
                title: ann.title.trim(),
                category: ann.category ?? org.org_type ?? null,
                announce_date: ann.announce_date ?? null,
                description: ann.description ?? null,
                source_url: ann.source_url ?? null,
                is_active: true,
                scraped_at: new Date().toISOString()
            };
            // 증분 수집: unique_key 중복 여부 먼저 확인
            const { data: existing } = await supabase.from("rfp_announcements").select("id").eq("unique_key", unique_key).maybeSingle();
            if (existing) {
                skipped++;
                continue;
            }
            const { error: insertErr } = await supabase.from("rfp_announcements").insert(row);
            if (insertErr) {
                console.error(`[RfpScraper] Insert error for "${ann.title}":`, insertErr.message);
            } else {
                inserted++;
                // 이메일 발송용 신규 공고 누적
                newItems.push({
                    title: ann.title.trim(),
                    org_name: org.org_name,
                    announce_date: ann.announce_date ?? null,
                    category: ann.category ?? null,
                    source_url: ann.source_url ?? null
                });
            }
        }
        return {
            ...base,
            inserted,
            skipped,
            newItems
        };
    }
}
}),
"[project]/src/app/api/cron/rfp-scrape/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "GET",
    ()=>GET,
    "dynamic",
    ()=>dynamic,
    "maxDuration",
    ()=>maxDuration
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$services$2f$rfp$2d$scraper$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/services/rfp-scraper.ts [app-route] (ecmascript)");
;
;
const dynamic = "force-dynamic";
const maxDuration = 300; // Vercel Pro: 최대 5분 실행 허용
async function GET(request) {
    // ── 보안: CRON_SECRET 검증 ─────────────────────────────────────────────
    const authHeader = request.headers.get("authorization");
    const cronSecret = process.env.CRON_SECRET;
    if (cronSecret && authHeader !== `Bearer ${cronSecret}`) {
        console.warn("[rfp-scrape] Unauthorized cron request");
        return new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"]("Unauthorized", {
            status: 401
        });
    }
    const startedAt = new Date().toISOString();
    console.log(`[rfp-scrape] Cron started at ${startedAt}`);
    try {
        const scraper = new __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$services$2f$rfp$2d$scraper$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["RfpScraper"]();
        const results = await scraper.run();
        const totalInserted = results.reduce((s, r)=>s + r.inserted, 0);
        const totalSkipped = results.reduce((s, r)=>s + r.skipped, 0);
        const errors = results.filter((r)=>r.status === "error");
        console.log(`[rfp-scrape] Done. inserted=${totalInserted}, skipped=${totalSkipped}, errors=${errors.length}`);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            startedAt,
            completedAt: new Date().toISOString(),
            summary: {
                totalOrgs: results.length,
                totalInserted,
                totalSkipped,
                totalErrors: errors.length
            },
            results
        });
    } catch (err) {
        console.error("[rfp-scrape] Fatal error:", err);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: false,
            error: err.message,
            startedAt
        }, {
            status: 500
        });
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__8d864ba6._.js.map