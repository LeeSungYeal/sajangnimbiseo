{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/antigravity/SajangnimBiseo/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\r\nimport { cookies } from 'next/headers'\r\n\r\nexport async function createClient() {\r\n    const cookieStore = await cookies()\r\n\r\n    return createServerClient(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n        {\r\n            cookies: {\r\n                getAll() {\r\n                    return cookieStore.getAll()\r\n                },\r\n                setAll(cookiesToSet) {\r\n                    try {\r\n                        cookiesToSet.forEach(({ name, value, options }) =>\r\n                            cookieStore.set(name, value, options)\r\n                        )\r\n                    } catch {\r\n                        // The `setAll` method was called from a Server Component.\r\n                        // This can be ignored if you have middleware refreshing\r\n                        // user sessions.\r\n                    }\r\n                },\r\n            },\r\n        }\r\n    )\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,0IAAO;IAEjC,OAAO,IAAA,+LAAkB,sUAGrB;QACI,SAAS;YACL;gBACI,OAAO,YAAY,MAAM;YAC7B;YACA,QAAO,YAAY;gBACf,IAAI;oBACA,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC1C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAErC,EAAE,OAAM;gBACJ,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACrB;YACJ;QACJ;IACJ;AAER"}},
    {"offset": {"line": 186, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/antigravity/SajangnimBiseo/src/lib/actions/store.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport * as cheerio from \"cheerio\";\r\n\r\nexport type ExtractResult = {\r\n    success: boolean;\r\n    name?: string;\r\n    error?: string;\r\n};\r\n\r\nexport type RegisterResult = {\r\n    success: boolean;\r\n    error?: string;\r\n};\r\n\r\n/**\r\n * Extracts the store name from the given Naver Map URL.\r\n */\r\nexport async function extractStoreName(url: string): Promise<ExtractResult> {\r\n    if (!url) {\r\n        return { success: false, error: \"URL을 입력해주세요.\" };\r\n    }\r\n\r\n    try {\r\n        // 1. Follow redirects (short URL -> full URL)\r\n        // We use a desktop UA for the initial fetch to ensure correct redirection behavior,\r\n        // although Naver often redirects correctly with any UA.\r\n        const initialResponse = await fetch(url, {\r\n            redirect: \"follow\",\r\n            headers: {\r\n                \"User-Agent\":\r\n                    \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\",\r\n            },\r\n        });\r\n\r\n        if (!initialResponse.ok) {\r\n            return { success: false, error: \"URL에 접근할 수 없습니다.\" };\r\n        }\r\n\r\n        const finalUrl = initialResponse.url;\r\n\r\n        // 2. Extract Place ID from the final URL\r\n        // Patterns:\r\n        // https://map.naver.com/p/entry/place/2043252871?...\r\n        // https://m.place.naver.com/restaurant/2043252871/...\r\n        const placeIdMatch = finalUrl.match(/place\\/(\\d+)/) || finalUrl.match(/restaurant\\/(\\d+)/);\r\n\r\n        if (!placeIdMatch) {\r\n            // Fallback: Try parsing the initial HTML if it's not a standard map URL but still contains title\r\n            // (Unlikely for Naver Map shortlinks, but safety net)\r\n            const html = await initialResponse.text();\r\n            const $ = cheerio.load(html);\r\n            let title = $('meta[property=\"og:title\"]').attr(\"content\") || $(\"title\").text();\r\n            if (title && title !== \"네이버지도\" && title !== \"네이버 플레이스\") {\r\n                title = title.replace(/ - 네이버 지도.*$/, \"\").replace(/ : 네이버.*$/, \"\").trim();\r\n                return { success: true, name: title };\r\n            }\r\n            return { success: false, error: \"매장 ID를 찾을 수 없습니다.\" };\r\n        }\r\n\r\n        const placeId = placeIdMatch[1];\r\n\r\n        // 3. Fetch Mobile Place URL for SSR Content\r\n        // m.place.naver.com returns Server-Side Rendered HTML suitable for crawlers if we use a mobile UA\r\n        const mobileUrl = `https://m.place.naver.com/place/${placeId}/home`;\r\n\r\n        const mobileResponse = await fetch(mobileUrl, {\r\n            headers: {\r\n                \"User-Agent\":\r\n                    \"Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1\",\r\n            },\r\n        });\r\n\r\n        if (!mobileResponse.ok) {\r\n            return { success: false, error: \"매장 정보를 가져올 수 없습니다.\" };\r\n        }\r\n\r\n        const html = await mobileResponse.text();\r\n        const $ = cheerio.load(html);\r\n\r\n        // 4. Extract Title\r\n        let title = $('meta[property=\"og:title\"]').attr(\"content\");\r\n\r\n        if (!title) {\r\n            // Fallback to title tag\r\n            title = $(\"title\").text();\r\n        }\r\n\r\n        if (!title) {\r\n            return { success: false, error: \"매장명을 찾을 수 없습니다.\" };\r\n        }\r\n\r\n        // 5. Clean up title\r\n        // Example: \"누리마을감자탕 영도점 : 네이버\" -> \"누리마을감자탕 영도점\"\r\n        title = title.replace(/ : 네이버.*$/, \"\").replace(/ - 네이버 지도.*$/, \"\").trim();\r\n\r\n        return { success: true, name: title };\r\n\r\n    } catch (error) {\r\n        console.error(\"Error extracting store name:\", error);\r\n        return { success: false, error: \"매장명 추출 중 시스템 오류가 발생했습니다.\" };\r\n    }\r\n}\r\n\r\n/**\r\n * Registers the store in the database.\r\n */\r\nexport async function registerStore(name: string, url: string): Promise<RegisterResult> {\r\n    try {\r\n        const supabase = await createClient();\r\n\r\n        // Get current user (required for RLS)\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n\r\n        if (!user) {\r\n            return { success: false, error: \"로그인이 필요합니다.\" };\r\n        }\r\n\r\n        // Insert into store_management\r\n        // Note: We are using the types we manually updated\r\n        const { error } = await supabase\r\n            .from(\"store_management\")\r\n            .insert({\r\n                store_name: name,\r\n                store_url: url,\r\n                user_id: user.id,\r\n            });\r\n\r\n        if (error) {\r\n            console.error(\"Supabase insert error:\", error);\r\n            return { success: false, error: \"매장 등록에 실패했습니다.\" };\r\n        }\r\n\r\n        return { success: true };\r\n    } catch (error) {\r\n        console.error(\"Register store error:\", error);\r\n        return { success: false, error: \"매장 등록 중 오류가 발생했습니다.\" };\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 338, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/antigravity/SajangnimBiseo/.next-internal/server/app/analytics/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {extractStoreName as '40f3350d493fdfe7e9bba79166fbb36715a4a0a40f'} from 'ACTIONS_MODULE0'\nexport {registerStore as '606a068d6f471deb53dd457c2c2b9282f3a9f78025'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}